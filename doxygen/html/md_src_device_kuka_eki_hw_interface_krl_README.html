<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SWD-Vision-Software: Configuring EKI on the controller</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SWD-Vision-Software
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Configuring EKI on the controller </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This guide highlights the steps needed in order to successfully configure the <b>EKI interface</b> on the controller to work with the <b>kuka_eki_hw_interface</b> on your PC with ROS.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
1. Controller network configuration</h1>
<p>Windows runs behind the SmartHMI on the teach pad. Make sure that the <b>Windows interface</b> of the controller and the * *PC with ROS** is connected to the same subnet.</p>
<ol type="1">
<li>Log in as <b>Expert</b> or <b>Administrator</b> on the teach pad and navigate to <b>Network configuration</b> (<b>Connect-up &gt; Network configuration &gt; Activate advanced configuration</b>).</li>
<li>There should already be an interface checked out as the <b>Windows interface</b>. For example:<ul>
<li><b>IP</b>: <code>192.168.1.121</code></li>
<li><b>Subnet mask</b>: <code>255.255.255.0</code></li>
<li><b>Default gateway</b>: <code>192.168.1.121</code></li>
<li><b>Windows interface checkbox</b> should be checked.</li>
</ul>
</li>
<li>Make note of the above IP address as you will need it later.</li>
<li>(Optional) Run <b>cmd.exe</b> and ping the PC you want to communicate with on the same subnet (e.g. 192.168.1.10). If your <b>PC</b> has an IP address on the same subnet as the <b>Windows interface</b> on the controller, the controller should receive answers from the PC.</li>
</ol>
<h1><a class="anchor" id="autotoc_md3"></a>
2. KRL Files</h1>
<p>The files included in the <code>kuka_eki_hw_interface/krl</code> folder provide the KRL interface and Ethernet packet configurations. The XML files need to be modified to work for your specific configuration:</p>
<h4><a class="anchor" id="autotoc_md4"></a>
EkiHwInterface.xml</h4>
<ol type="1">
<li>Edit the <code>IP</code> tag so that it corresponds to the IP address (<code>address.of.robot.controller</code>) corresponding to the * *Windows interface** of the controller (noted earlier).</li>
<li>Keep the <code>PORT</code> tag as it is (<code>54600</code>) or change it if you want to use another port (must be in the range of <code>54600</code> to <code>54615</code>).</li>
</ol>
<p>Note that the <code>eki/robot_address</code> and <code>eki/robot_port</code> parameters of the <code>kuka_eki_hw_interface</code> must correspond to the <code>IP</code>and <code>PORT</code> set in this XML file.</p>
<h4><a class="anchor" id="autotoc_md5"></a>
Copy files to controller</h4>
<p>The files <code>kuka_eki_hw_interface.dat</code> and <code>kuke_eki_hw_interface.src</code> should not be edited. All files are now ready_ to be copied to the Kuka controller. Using WorkVisual or a USB drive (with appropriate privleges):</p>
<ol type="1">
<li>Copy <code>kuka_eki_hw_interface.dat</code> and <code>kuka_eki_hw_interface.src</code> files to <code>KRC:\R1\Program</code>.</li>
<li>Copy <code>EkiHwInterface.xml</code> to <code>C:\KRC\ROBOTER\Config\User\Common\EthernetKRL\</code>.</li>
</ol>
<h4><a class="anchor" id="autotoc_md6"></a>
Command Buffering Setup</h4>
<p>The driver currently limits the number of queued joint targets to prevent unbounded trajectory lag (error) that can occur when sufficiently dense target trajectories (temporal and/or spatial) are requested. The size of the buffer is set via the parameter <code>eki/max_cmd_buf_len</code>. When not present, the buffer defaults to five (5), which is the maximum number of instructions allowed in the controller's advance_ run (i.e., KRC internal interpolator lookahead).</p>
<p>With the buffering active, overly dense trajectory points are dropped with the result being small and bounded trajectory lag at the expense of some positional deviation (dropped waypoints are not strictly enforced). For paths that require exact positional accuracy buffering can be disabled by setting the limit to a sufficiently large number (e.g., 512) with the caveat that dense trajectories might result in low-than-requested velocity and subsequent time lag. In other words, the buffering limit can be seen as a tradeoff between positional accuracy and time accuracy.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
4. Testing</h1>
<p>At this point you are ready_ to test the EKI interface. Before the test, make sure that:</p>
<ul>
<li>You have specified the <code>eki/robot_address</code> and <code>eki/robot_port</code> of the <b>kuka_eki_hw_interface</b> to correspond with the KRL files on the controller.</li>
<li>You have a launch-file loading the network parameters, robot description, kuka_hw_interface, hardware controller and controller joint names.</li>
</ul>
<p>The next steps describe how to launch the test file:</p>
<ul>
<li>On the robot, Connect the servers</li>
</ul>
<ol type="1">
<li>On the teach pad, enter mode <b>T1</b> for testing purposes.</li>
<li>Navigate to <code>KRC:\R1\Program</code> and select <code>kuka_eki_hw_interface.src</code>.</li>
<li>Press and hold an enabling switch and the run/play-button. The robot will release its breaks and a message like * *Programmed path reached (BCO)** will be shown at the teach pad.</li>
<li>Press and hold again. The robot is now waiting for clients to connect.</li>
</ol>
<ul>
<li>Note that T1-mode limits the robot movement velocity and is intended for testing purposes. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
